{"version":3,"sources":["../../src/controllers/user.controller.js"],"names":["mongoose","require","nodemailer","User","model","Gig","mailer","jwt","superSecret","module","exports","getUserById","req","res","next","findOne","username","params","err","user","json","user_id","_id","getUserByEmail","email","status","addUser2","create","body","code","message","errors","addUser","setPassword","password","save","sendMail","getUsers","find","users","getOneUser","findById","getByUsername","updateUser","result","token","sign","id","expiresInMinutes","deleteUser","remove","addedBy","gig","deleteAllUsers"],"mappings":"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","file":"user.controller.js","sourcesContent":["var mongoose = require('mongoose');\nrequire(\"../models/user.model\");\nrequire(\"../models/gig.model\");\n\nvar nodemailer = require('nodemailer');\n\nvar User = mongoose.model('User');\nvar Gig = mongoose.model(\"Gig\");\n\nvar mailer = require(\"./mailer.controller.js\");\n\nvar jwt = require('jsonwebtoken');\nvar superSecret = 'tangoforme';\n\n\nmodule.exports = {\n    getUserById: function(req, res, next) {\n        User.findOne({\n            username: req.params.username\n        }, function(err, user) {\n            if (err) {\n                return res.json(err);\n            }\n            if (!user) {\n                return res.json(\"User doesn't exist\");\n            }\n            req.user_id = user._id;\n            next();\n        });\n    },\n\n    getUserByEmail: function(req, res) {\n        User.findOne({\n            email: req.params.email\n        }, function(err, user) {\n            if (err) {\n                return res.json(err);\n            }\n            if (!user) {\n                return res.json(\"User doesn't exist\");\n            }\n            res.status(200).json(user);\n        });\n    },\n\n    addUser2: function(req, res) {\n        User.create(req.body, function(err, user) {\n            if (err) {\n                if (err.code === 11000) {\n                    res.json({\n                        message: 'Username or Email already taken'\n                    });\n                } else {\n                    res.json({\n                        message: err.errors.email.message\n                    });\n                }\n                res.json(err);\n            }\n            res.status(201).json(user.username);\n        });\n    },\n\n    addUser: function(req, res) {\n        var user = new User(req.body);\n        user.setPassword(req.body.password);\n        user.save(function(err, user) {\n            if (err) {\n                return res.json(err);\n            }\n            mailer.sendMail(user.email, \"Welcome to Tango Nigeria\", \"Hello, \" + user.username + \" Welcome to Tango Nigeria. Login here: http://andela-ssunday.github.io/tangong\");\n            res.status(201).json(user);\n        });\n    },\n\n    getUsers: function(req, res) {\n        User.find(function(err, users) {\n            if (err) {\n                return res.json(err);\n            }\n            res.status(200).json(users);\n        });\n    },\n\n    getOneUser: function(req, res) {\n        User.findById({\n            _id: req.params.user_id\n        }, function(err, user) {\n            if (err) {\n                return res.json(err);\n            }\n            res.status(201).json(user);\n        });\n    },\n\n    getByUsername: function(req, res) {\n        User.findOne({\n            username: req.params.username\n        }, function(err, user) {\n            if (err) {\n                return res.json(err);\n            }\n            res.status(201).json(user);\n        });\n    },\n\n    updateUser: function(req, res) {\n\n        User.findById(req.params.user_id, function(err, user) {\n            if (err) {\n                return res.json(err);\n            }\n            user.username = req.body.username;\n            user.password = req.body.password;\n            user.save(function(err, result) {\n                if (err) {\n                    return res.json(err);\n                }\n                var token = jwt.sign({\n                    id: result._id,\n                    username: result.username,\n                    email: result.email\n                }, superSecret, {\n                    expiresInMinutes: 43200\n                });\n                res.status(201).json({\n                    token: token\n                });\n            })\n        })\n    },\n\n    deleteUser: function(req, res) {\n        User.remove({\n            _id: req.params.user_id\n        }, function(err, user) {\n            if (err) {\n                return res.json(err);\n            } else {\n                Gig.remove({\n                    addedBy: req.params.user_id\n                }, function(err, gig) {\n                    if (err) {\n                        return res.json(err);\n                    }\n                    res.status(200).json(gig);\n                });\n            }\n        });\n    },\n\n    deleteAllUsers: function(req, res) {\n        User.remove({}, function(err, users) {\n            if (err) {\n                return res.json(err);\n            }\n            res.status(200).json(users);\n        });\n    }\n};\n"]}